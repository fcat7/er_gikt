## 一、前期准备：梳理项目现状

先快速确认项目的 Git 基础状态，避免落地时冲突：

1. **检查 Git 仓库**：确保项目已初始化 Git（执行 `git status` 无报错），若未初始化先执行 `git init`；
2. **分支现状**：查看现有分支（`git branch`），后续需将核心分支规整为 `main/master`（正式版本）和 `develop`（开发分支）；
3. **历史提交**：无需修改历史提交记录，仅要求**新提交**遵循规范，降低落地成本；
4. **环境准备**：确保本地安装了 Node.js（≥16.x，自动化工具依赖），可执行 `node -v` 检查，未安装可从 [Node.js 官网](https://nodejs.org/) 下载。

## 二、第一步：基础规范落地（手动阶段，先养成习惯）

这一步先配置「提交模板」和「基础分支」，让团队先手动遵循规范，无需依赖自动化工具。

### 1. 创建 Git 提交模板（强制规范格式）

在项目根目录执行以下操作：

```bash
# 1. 创建提交模板文件 .gitmessage
cat > .gitmessage << 'EOF'
# <type>(<scope>): <subject> (首行≤50字符, 动词开头, 勿用句号)
# 类型: feat, fix, docs, style, refactor, perf, test, chore, revert
# 标记: 破坏性变更请在类型后加 '!' (如 feat!)
# ------------------ 必填 Header ------------------
# 示例: feat(model): 引入CognitiveRNN记忆模块
# ------------------ Body (选填) ------------------

# [🔴 BREAKING] / [🟡 CHANGE] / [🟢 SAFE] (视觉标记必须放在此行)
# 动机: 为什么要做这个改动？（科研场景需说明实验/论文需求）
# 实现: 简要描述实现逻辑（核心代码/算法变更）
# 影响: 对实验结果/性能的影响（需关联实验ID）

# ----------------- Footer (选填) -----------------
# EXP: #15, #20 (关联实验ID，带🔴/🟡标记必填)
# PAPER: TABLE2, CAMERA-READY (关联论文模块/阶段)
# VALIDATE: RTX4050验证通过，速度提升20% (验证结果)
# Closes: #42 (关闭的Issue号)
# BREAKING CHANGE: 描述不兼容变更（仅破坏性提交填写）
EOF

# 2. 配置当前项目使用该模板（仅当前项目生效）
git config --local commit.template .gitmessage

# 3. （可选）将 .gitmessage 加入 .gitignore（避免提交到仓库）
echo ".gitmessage" >> .gitignore
```

配置完成后，执行 `git commit` 时，编辑器会自动弹出该模板，你只需按提示填写即可。

### 2. 规整分支结构（适配大厂分支规范）

```bash
# 1. 若项目无 main/master 分支，将当前分支重命名为 main（阿里/字节标准）
git branch -M main

# 2. 创建 develop 开发分支（核心开发分支，所有功能开发都基于此）
git checkout -b develop

# 3. 推送永久分支到远程仓库
git push -u origin main
git push -u origin develop
```

后续所有开发工作都在 `develop` 分支或基于 `develop` 创建的临时分支中进行，禁止直接在 `main` 分支开发。

### 3. 规范临时分支命名

后续创建临时分支时，严格遵循 `{类型}-{模块/实验ID}-{简短描述}` 格式，示例：

```bash
# 新增实验模块
git checkout -b feat-model-cognitivernn develop

# 修复数据加载bug
git checkout -b fix-data-nanfill develop

# 实验验证（科研项目专属）
git checkout -b exp-20-amp-test develop
```

## 三、第二步：自动化落地（强制规范，避免人工错误）

这一步通过 `husky + commitlint` 强制校验提交信息，通过 `standard-version` 自动生成 CHANGELOG、打 Tag、递增版本号，完全适配大厂自动化标准。

### 1. 初始化 npm 配置（非 Node 项目也需执行）

若项目不是 Node.js 项目，只需初始化空的 `package.json` 即可：

```bash
# 初始化 package.json（一路回车即可，默认配置）
npm init -y
```

### 2. 安装自动化工具依赖

```bash
# 安装 commitlint（校验提交信息）、husky（Git钩子）、standard-version（版本发布）
npm install --save-dev @commitlint/cli @commitlint/config-conventional husky standard-version
```

### 3. 配置 commitlint（校验提交语法）

```bash
# 创建 commitlint 配置文件
echo "module.exports = { extends: ['@commitlint/config-conventional'] };" > commitlint.config.js
```

若你是科研项目，需要强制校验「带🔴标记的提交必须包含 EXP 脚注」，可替换上述配置为：

```javascript
// commitlint.config.js
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    // 强制[🔴 BREAKING]提交必须包含 EXP 脚注（科研溯源必备）
    'footer-match': [2, 'always', [
      {
        pattern: /\[🔴 BREAKING\]/,
        footerPattern: /EXP: #\d+(-#\d+)?/
      }
    ]],
    // 限制提交类型为规范中定义的类型
    'type-enum': [
      2,
      'always',
      ['feat', 'fix', 'docs', 'style', 'refactor', 'perf', 'test', 'chore', 'revert', 'merge']
    ]
  }
};
```

### 4. 配置 husky（Git 钩子，提交前自动校验）

```bash
# 初始化 husky
npm set-script prepare "husky install"
npm run prepare

# 添加 commit-msg 钩子（校验提交信息）
npx husky add .husky/commit-msg 'npx --no -- commitlint --edit "$1"'

# 添加 pre-commit 钩子（可选，比如校验代码格式，非必须）
npx husky add .husky/pre-commit 'echo "提交前校验通过 ✅"'
```

配置完成后，若提交信息不符合规范（比如类型写错、标题过长），Git 会直接拒绝提交，强制遵循规范。

### 5. 配置版本发布脚本（自动生成 CHANGELOG、打 Tag）

修改 `package.json` 中的 `scripts` 字段，添加版本发布命令：

```json
// package.json
{
  "scripts": {
    "prepare": "husky install",
    "release": "standard-version", // 发布正式版本
    "release:alpha": "standard-version --prerelease alpha", // 发布alpha预发布版本
    "release:beta": "standard-version --prerelease beta", // 发布beta预发布版本
    "release:rc": "standard-version --prerelease rc" // 发布rc预发布版本
  }
}
```

## 四、第三步：版本发布与 CHANGELOG 落地

### 1. 首次发布版本（科研项目建议从 0.1.0 开始）

```bash
# 切换到 develop 分支，确保所有变更已合入
git checkout develop

# 首次发布，指定初始版本号（比如 0.1.0）
npx standard-version --release-as 0.1.0

# 推送版本提交和 Tag 到远程
git push --follow-tags origin develop

# 将 develop 分支合入 main 分支（正式版本）
git checkout main
git merge --no-ff develop
git push origin main
```

执行后，项目根目录会自动生成 `CHANGELOG.md`，并创建 `v0.1.0` Tag，版本号自动写入 `package.json`。

### 2. 后续发布版本（自动化递增）

```bash
# 发布正式版本（自动根据提交类型递增 MAJOR/MINOR/PATCH）
npm run release

# 发布预发布版本（比如 alpha 版，科研实验用）
npm run release:alpha

# 推送版本到远程
git push --follow-tags origin develop
git checkout main && git merge --no-ff develop && git push origin main
```

- 若提交包含 `feat!`/`fix!`（破坏性变更），自动递增 **主版本号**（如 0.1.0 → 1.0.0）；
- 若提交包含 `feat`（无!），自动递增 **次版本号**（如 0.1.0 → 0.2.0）；
- 若提交仅包含 `fix`/`perf`，自动递增 **修订号**（如 0.1.0 → 0.1.1）；
- 仅 `docs`/`style`/`refactor` 等提交，版本号不变（自动添加内部迭代号，如 0.1.0+1）。

### 3. 完善 CHANGELOG 的科研溯源信息

自动生成的 `CHANGELOG.md` 基础内容后，你需要补充**实验ID、论文模块、验证环境**等科研相关信息（参考规范中的示例），比如：

```markdown
## [0.1.0] - 2026-01-24 🎯 PAPER-CAMERA-READY
### Features
- feat(model): 实现CognitiveRNN认知记忆模块 (#a1b2c3d)
  - EXP: #20，PAPER: TABLE2，VALIDATE: RTX4050验证通过
```

## 五、第四步：团队协作落地（确保全员遵循）

1. **文档同步**：将规范文档（你提供的这套）放到项目 `docs/` 目录，提交到 `develop` 分支，让所有成员可见；
2. **CI/CD 校验**：在 GitHub Actions/GitLab CI 中添加提交校验（参考规范中的 CI/CD 示例），拒绝不符合规范的 PR/MR；
3. **约定合入规则**：所有临时分支需通过 PR/MR 合入 `develop`，合入前必须通过 commitlint 校验，且提交记录无 `[WIP]` 标记；
4. **定期维护**：每次发布版本前，整理 `develop` 分支的提交记录，确保无无效提交，然后合入 `main` 分支并打 Tag。

## 总结

你在已有项目中落地这套规范的核心步骤可总结为：

1. **基础层**：配置 Git 提交模板 + 规整分支结构，先手动遵循规范；
2. **自动化层**：通过 `husky + commitlint` 强制校验提交信息，`standard-version` 自动管理版本和 CHANGELOG；
3. **科研适配层**：在提交脚注中补充 EXP/PAPER/VALIDATE 信息，关联实验和论文，实现全链路溯源；
4. **协作层**：通过分支规则和 CI/CD 确保团队全员遵循，禁止人工操作版本和 Tag。

这套流程完全适配阿里/字节的大厂标准，同时兼顾科研项目的溯源需求，落地后可实现「提交 → 版本 → CHANGELOG → 论文实验」的全链路可追溯，且无需手动记忆规范，全靠工具强制约束。
